create or replace FUNCTION F_GET_LADWF (nDosId NUMBER, sUticode VARCHAR2)
   RETURN VARCHAR2
    IS
        NSCORE   VARCHAR2(50);
        NHLAD    VARCHAR2(50);
		NNAP     VARCHAR2(50);
		NMTINV   NUMBER;
		NTACCODE VARCHAR2(50);
		NNBP     NUMBER;
		SRESULT  VARCHAR2(50);

    BEGIN
        BEGIN
         SELECT  pav4_criteria.F_GET_HLAD(nDosId,'ORFI')INTO NHLAD from dual;     
         SELECT  pav4_criteria.F_GET_SCORE(nDosId,'ORFI') INTO NSCORE from dual;
         SELECT  pav4_criteria.F_GET_NAPCODE(nDosId,'ORFI')INTO NNAP from dual;
         SELECT  pav4_criteria.F_GET_MTINV(nDosId,'ORFI') INTO NMTINV from dual;
         SELECT  pav4_criteria.F_GET_TACCODE(nDosId,'ORFI') INTO NTACCODE from dual;
         SELECT  pav4_criteria.F_GET_NBPERIOD(nDosId,'ORFI')INTO NNBP from dual;


IF (NHLAD IS NULL OR NHLAD='LADSGM2') THEN
         IF (NSCORE='SCV' OR NSCORE='SCORE VERT') THEN
             IF (NTACCODE='CBM' AND NNAP in ('1201','3101','3102','3103','3104','3105') AND NMTINV <=500000 AND (NNBP BETWEEN 36 AND 60)
			 OR NTACCODE='CBM' AND NNAP NOT in ('1201','3101','3102','3103','3104','3105') AND NMTINV <=250000 AND (NNBP BETWEEN 36 AND 60)) THEN
			      SRESULT:='0';--UNIPERS RMCP


			 ELSIF  (NTACCODE='CBM' AND NNAP in ('1201','3101','3102','3103','3104','3105') AND (NMTINV BETWEEN 500001 AND 1000000)  AND (NNBP BETWEEN 36 AND 60)
			 OR NTACCODE='CBM' AND NNAP NOT in ('1201','3101','3102','3103','3104','3105') AND (NMTINV BETWEEN 250001 AND 500000) AND (NNBP BETWEEN 36 AND 60)) THEN
			      SRESULT:='1';-- UNIPERS DG DGA--changed ines


			 ELSIF  (NTACCODE='CBM' AND NNAP in ('1201','3101','3102','3103','3104','3105') AND (NMTINV BETWEEN 1000001 AND 2500000)  AND (NNBP BETWEEN 36 AND 60)
			 OR NTACCODE='CBM' AND NNAP NOT in ('1201','3101','3102','3103','3104','3105') AND (NMTINV BETWEEN 500001 AND 2500000) AND (NNBP BETWEEN 36 AND 60)) THEN
			      SRESULT:='2';--DS RMCP RISQUE --added ines

			 ELSIF (NTACCODE='CBM' AND (NMTINV >= 2500001 ) ) THEN
			     SRESULT:='3';--DS DG RISQUE 	--added ines

			 ELSIF (NTACCODE='CBM' AND (NMTINV BETWEEN 1000000 AND 2500000) AND NNBP<=60) THEN
			     SRESULT:='2';--DS RMCP RISQUE
			 ELSIF (NTACCODE='CBM' AND (NMTINV BETWEEN 2500001 AND 5000000) AND NNBP<=60) THEN
			     SRESULT:='3';--DS DG RISQUE SGM
			 ELSIF 	( NTACCODE='CBI' AND NMTINV<=5000000 AND NNBP<=144) THEN
			     SRESULT:='4';--DS RMCP RISQUE---2 --a changer ines 
		 ELSIF 	 ( NTACCODE='CBI' AND (NMTINV BETWEEN 5000001 AND 10000000)  AND NNBP<=144) THEN
		     SRESULT:='4';--DS DG RISQUE SGM---3  --a changer ines
			 ELSE
			     SRESULT:='4';--DEPUIS DCIIT
			 END IF;

       ELSIF (NSCORE IS NULL OR NSCORE='ND') THEN

		   IF (NTACCODE='CBI' )

           THEN
		      SRESULT:='4';--DEPUIS DCIIT

         END IF;
        
        ELSIF (NSCORE='SCO' OR NSCORE='SCORE ORANGE') THEN

		   IF (NTACCODE='CBM' AND NMTINV<=2500000 AND NNBP<=60)
           --OR (NTACCODE='CBI' AND NMTINV<=5000000 AND NNBP<=144)) -----a changer ines
           THEN
		      SRESULT:='2';--DS RMCP RISQUE

		   ELSIF (NTACCODE='CBM' AND (NMTINV BETWEEN 2500001 AND 5000000) AND NNBP<=60) 
           --OR (NTACCODE='CBI' AND (NMTINV BETWEEN 5000001 AND 10000000) AND NNBP<=144)) -----a changer ines
           THEN

              SRESULT:='3';--DS DG RISQUE SGM
		   ELSE
              SRESULT:='4';--DEPUIS DCIIT
		   END IF;
		  ELSIF (NSCORE='SCR' OR NSCORE='SCORE ROUGE') THEN
		     SRESULT:='5';--CLASSEMENT SANS SUITE
        END IF;


    ELSE
    SRESULT:='4';--DEPUIS DCIIT
  END IF; 


        RETURN SRESULT;
    END;
END F_GET_LADWF;